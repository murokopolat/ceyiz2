import React, { useState, useMemo, useEffect, useCallback } from 'react';

// --- İKON BİLEŞENLERİ (Harici kütüphane olmadan ikon kullanımı için) ---
const IconPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>;
const IconEdit = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>;
const IconLogOut = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>;
const IconUsers = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>;
const IconDownload = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>;
const IconChevronDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>;

// --- SAHTE VERİLER (Backend simülasyonu için) ---
const MOCK_DATA = {
    user: {
        id: 1,
        email: 'gelin@test.com',
        partnerEmail: 'damat@test.com',
        weddingDate: '2025-10-25',
        totalBudget: 150000,
    },
    categories: [
        { id: 1, name: 'Mutfak Eşyaları' },
        { id: 2, name: 'Mobilya & Dekorasyon' },
        { id: 3, name: 'Elektronik & Beyaz Eşya' },
        { id: 4, name: 'Ev Tekstili' },
        { id: 5, name: 'Banyo' },
        { id: 6, name: 'Diğer' },
    ],
    items: [
        { id: 1, name: 'Buzdolabı', price: 28000, status: 'alındı', priority: 'zorunlu', categoryId: 3, link: '', photo: 'https://placehold.co/100x100/e2e8f0/334155?text=Buzdolab%C4%B1' },
        { id: 2, name: 'Yemek Takımı (12 Kişilik)', price: 7500, status: 'alınacak', priority: 'zorunlu', categoryId: 1, link: '', photo: '' },
        { id: 3, name: 'Köşe Koltuk Takımı', price: 35000, status: 'alınacak', priority: 'zorunlu', categoryId: 2, link: '', photo: 'https://placehold.co/100x100/e2e8f0/334155?text=Koltuk' },
        { id: 4, name: 'Airfryer', price: 4500, status: 'hediye', priority: 'isteğe bağlı', categoryId: 3, link: '', photo: '' },
        { id: 5, name: 'Nevresim Takımı', price: 1200, status: 'alındı', priority: 'zorunlu', categoryId: 4, link: '', photo: '' },
        { id: 6, name: 'Robot Süpürge', price: 15000, status: 'alınacak', priority: 'lüks', categoryId: 3, link: '', photo: '' },
    ],
    templates: [
        {
            name: "Temel Mutfak Paketi",
            items: [
                { name: 'Tencere Seti', price: 3000, priority: 'zorunlu', categoryId: 1 },
                { name: 'Çatal Kaşık Bıçak Takımı', price: 2500, priority: 'zorunlu', categoryId: 1 },
                { name: 'Blender Seti', price: 1500, priority: 'isteğe bağlı', categoryId: 1 },
            ]
        },
        {
            name: "Full Salon Paketi",
            items: [
                { name: 'TV Ünitesi', price: 5000, priority: 'zorunlu', categoryId: 2 },
                { name: 'Orta Sehpa', price: 2000, priority: 'zorunlu', categoryId: 2 },
                { name: 'Halı', price: 3000, priority: 'zorunlu', categoryId: 2 },
                { name: 'Dekoratif Tablolar', price: 1000, priority: 'lüks', categoryId: 2 },
            ]
        }
    ]
};

// --- YARDIMCI FONKSİYONLAR ---
const formatCurrency = (amount) => new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(amount);

// --- BİLEŞENLER ---

const AuthPage = ({ onLogin }) => {
    const [isLogin, setIsLogin] = useState(true);
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');

    const handleSubmit = (e) => {
        e.preventDefault();
        // Gerçek uygulamada burada API çağrısı yapılır.
        if (email && password) {
            onLogin(MOCK_DATA.user);
        }
    };

    return (
        <div className="min-h-screen bg-gray-50 flex flex-col justify-center items-center p-4">
            <div className="max-w-md w-full mx-auto">
                <h1 className="text-4xl font-bold text-center text-pink-600 mb-2 font-serif">Çeyiz Planlayıcım</h1>
                <p className="text-center text-gray-500 mb-8">Hayallerinize giden yolu planlayın.</p>
            </div>
            <div className="max-w-sm w-full mx-auto bg-white p-8 rounded-lg shadow-md">
                <div className="mb-6 text-center">
                    <h2 className="text-2xl font-bold text-gray-800">{isLogin ? 'Giriş Yap' : 'Kayıt Ol'}</h2>
                </div>
                <form onSubmit={handleSubmit}>
                    <div className="mb-4">
                        <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="email">E-posta</label>
                        <input className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-pink-500" id="email" type="email" placeholder="E-posta adresiniz" value={email} onChange={(e) => setEmail(e.target.value)} required />
                    </div>
                    <div className="mb-6">
                        <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="password">Şifre</label>
                        <input className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:ring-2 focus:ring-pink-500" id="password" type="password" placeholder="******************" value={password} onChange={(e) => setPassword(e.target.value)} required />
                        {isLogin && <a className="inline-block align-baseline font-bold text-sm text-pink-500 hover:text-pink-800" href="#">Şifremi Unuttum</a>}
                    </div>
                    <div className="flex items-center justify-between">
                        <button className="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full focus:outline-none focus:shadow-outline w-full" type="submit">
                            {isLogin ? 'Giriş Yap' : 'Kayıt Ol'}
                        </button>
                    </div>
                </form>
                <p className="text-center text-gray-500 text-sm mt-6">
                    {isLogin ? "Hesabınız yok mu?" : "Zaten bir hesabınız var mı?"}
                    <button className="font-bold text-pink-500 hover:text-pink-800 ml-1" onClick={() => setIsLogin(!isLogin)}>
                        {isLogin ? 'Kayıt Olun' : 'Giriş Yapın'}
                    </button>
                </p>
            </div>
        </div>
    );
};

const Header = ({ user, onLogout, weddingDate }) => {
    const [daysLeft, setDaysLeft] = useState(0);

    useEffect(() => {
        if (weddingDate) {
            const today = new Date();
            const wedding = new Date(weddingDate);
            const diffTime = wedding - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            setDaysLeft(diffDays > 0 ? diffDays : 0);
        }
    }, [weddingDate]);

    return (
        <header className="bg-white shadow-sm p-4 sticky top-0 z-40">
            <div className="container mx-auto flex justify-between items-center">
                <h1 className="text-2xl font-bold text-pink-600 font-serif">Çeyiz Planlayıcım</h1>
                <div className="flex items-center gap-4">
                    {weddingDate && (
                        <div className="text-center hidden sm:block">
                            <div className="text-2xl font-bold text-pink-500">{daysLeft}</div>
                            <div className="text-xs text-gray-500">GÜN KALDI</div>
                        </div>
                    )}
                    <span className="hidden md:inline text-gray-600">{user.email}</span>
                    <button onClick={onLogout} className="text-gray-500 hover:text-pink-600 p-2 rounded-full bg-gray-100 hover:bg-pink-100">
                        <IconLogOut />
                    </button>
                </div>
            </div>
        </header>
    );
};

const BudgetSummary = ({ totalBudget, spentAmount, categorySpending, categories }) => {
    const remainingBudget = totalBudget - spentAmount;
    const budgetExceeded = remainingBudget < 0;

    const categoryColors = [
        'bg-blue-500', 'bg-purple-500', 'bg-green-500', 
        'bg-yellow-500', 'bg-red-500', 'bg-indigo-500'
    ];

    const categoryData = useMemo(() => {
        return categories.map((cat, index) => {
            const spent = categorySpending[cat.id] || 0;
            const percentage = totalBudget > 0 ? (spent / totalBudget) * 100 : 0;
            return {
                ...cat,
                spent,
                percentage,
                color: categoryColors[index % categoryColors.length]
            };
        }).filter(cat => cat.spent > 0);
    }, [categorySpending, categories, totalBudget]);

    return (
        <div className="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 className="text-2xl font-bold mb-4">Bütçe Özeti</h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-center">
                <div className="bg-gray-100 p-4 rounded-lg">
                    <p className="text-sm text-gray-500">Toplam Bütçe</p>
                    <p className="text-2xl font-bold">{formatCurrency(totalBudget)}</p>
                </div>
                <div className="bg-green-100 p-4 rounded-lg">
                    <p className="text-sm text-green-700">Yapılan Harcama</p>
                    <p className="text-2xl font-bold text-green-800">{formatCurrency(spentAmount)}</p>
                </div>
                <div className={`${budgetExceeded ? 'bg-red-100' : 'bg-blue-100'} p-4 rounded-lg`}>
                    <p className={`text-sm ${budgetExceeded ? 'text-red-700' : 'text-blue-700'}`}>Kalan Bütçe</p>
                    <p className={`text-2xl font-bold ${budgetExceeded ? 'text-red-800' : 'text-blue-800'}`}>{formatCurrency(remainingBudget)}</p>
                </div>
            </div>
            {budgetExceeded && (
                <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-r-lg" role="alert">
                    <p className="font-bold">Uyarı!</p>
                    <p>Toplam bütçenizi {formatCurrency(Math.abs(remainingBudget))} aştınız.</p>
                </div>
            )}
            <div>
                <h3 className="text-lg font-bold mb-3">Kategori Harcamaları</h3>
                <div className="space-y-3">
                    {categoryData.length > 0 ? categoryData.map(cat => (
                        <div key={cat.id}>
                            <div className="flex justify-between mb-1">
                                <span className="text-base font-medium text-gray-700">{cat.name}</span>
                                <span className="text-sm font-medium text-gray-700">{formatCurrency(cat.spent)}</span>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-2.5">
                                <div className={`${cat.color} h-2.5 rounded-full`} style={{ width: `${cat.percentage}%` }}></div>
                            </div>
                        </div>
                    )) : <p className="text-gray-500 text-sm">Henüz kategori bazlı harcama yapılmadı.</p>}
                </div>
            </div>
        </div>
    );
};

const AddItemForm = ({ categories, onAddItem, onToggle }) => {
    const [name, setName] = useState('');
    const [price, setPrice] = useState('');
    const [categoryId, setCategoryId] = useState(categories[0]?.id || '');
    const [priority, setPriority] = useState('zorunlu');

    const handleSubmit = (e) => {
        e.preventDefault();
        const newItem = {
            id: Date.now(),
            name,
            price: parseFloat(price) || 0,
            status: 'alınacak',
            priority,
            categoryId: parseInt(categoryId),
            link: '',
            photo: ''
        };
        onAddItem(newItem);
        // Formu temizle
        setName('');
        setPrice('');
        onToggle();
    };

    return (
        <div className="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 className="text-2xl font-bold mb-4">Yeni Ürün Ekle</h2>
            <form onSubmit={handleSubmit}>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <input type="text" placeholder="Ürün Adı" value={name} onChange={e => setName(e.target.value)} className="p-2 border rounded-md w-full focus:outline-none focus:ring-2 focus:ring-pink-500" required />
                    <input type="number" placeholder="Fiyat (₺)" value={price} onChange={e => setPrice(e.target.value)} className="p-2 border rounded-md w-full focus:outline-none focus:ring-2 focus:ring-pink-500" />
                    <select value={categoryId} onChange={e => setCategoryId(e.target.value)} className="p-2 border rounded-md w-full bg-white focus:outline-none focus:ring-2 focus:ring-pink-500">
                        {categories.map(cat => <option key={cat.id} value={cat.id}>{cat.name}</option>)}
                    </select>
                    <select value={priority} onChange={e => setPriority(e.target.value)} className="p-2 border rounded-md w-full bg-white focus:outline-none focus:ring-2 focus:ring-pink-500">
                        <option value="zorunlu">Zorunlu</option>
                        <option value="isteğe bağlı">İsteğe Bağlı</option>
                        <option value="lüks">Lüks</option>
                    </select>
                </div>
                <div className="mt-4 flex justify-end gap-2">
                    <button type="button" onClick={onToggle} className="bg-gray-200 text-gray-800 px-4 py-2 rounded-full hover:bg-gray-300">İptal</button>
                    <button type="submit" className="bg-pink-600 text-white px-4 py-2 rounded-full hover:bg-pink-700">Ekle</button>
                </div>
            </form>
        </div>
    );
};

const ItemCard = ({ item, category, onUpdateStatus, onDelete }) => {
    const statusClasses = {
        'alınacak': 'bg-blue-100 text-blue-800',
        'alındı': 'bg-green-100 text-green-800',
        'hediye': 'bg-yellow-100 text-yellow-800',
    };
    const priorityClasses = {
        'zorunlu': 'border-red-500',
        'isteğe bağlı': 'border-yellow-500',
        'lüks': 'border-purple-500',
    };

    return (
        <div className={`bg-white p-4 rounded-lg shadow-sm flex flex-col md:flex-row items-start md:items-center justify-between gap-4 border-l-4 ${priorityClasses[item.priority]}`}>
            <div className="flex items-center gap-4 flex-1">
                <img src={item.photo || 'https://placehold.co/100x100/f1f5f9/cbd5e1?text=?'} alt={item.name} className="w-16 h-16 rounded-md object-cover hidden sm:block" />
                <div>
                    <h4 className="font-bold text-lg">{item.name}</h4>
                    <p className="text-sm text-gray-500">{category?.name}</p>
                    <p className="font-semibold text-pink-600 mt-1">{formatCurrency(item.price)}</p>
                </div>
            </div>
            <div className="flex items-center gap-2 w-full md:w-auto">
                 <select value={item.status} onChange={(e) => onUpdateStatus(item.id, e.target.value)} className={`p-2 border-0 rounded-full text-sm font-semibold w-full md:w-auto appearance-none text-center ${statusClasses[item.status]} focus:outline-none focus:ring-2 focus:ring-pink-500`}>
                    <option value="alınacak">Alınacak</option>
                    <option value="alındı">Alındı</option>
                    <option value="hediye">Hediye Gelecek</option>
                </select>
                <button onClick={() => onDelete(item.id)} className="text-gray-400 hover:text-red-600 p-2"><IconTrash /></button>
            </div>
        </div>
    );
};

const ItemList = ({ items, categories, onUpdateStatus, onDelete }) => {
    const [filters, setFilters] = useState({ search: '', status: 'all', priority: 'all' });
    
    const filteredItems = useMemo(() => {
        return items.filter(item => {
            const searchMatch = item.name.toLowerCase().includes(filters.search.toLowerCase());
            const statusMatch = filters.status === 'all' || item.status === filters.status;
            const priorityMatch = filters.priority === 'all' || item.priority === filters.priority;
            return searchMatch && statusMatch && priorityMatch;
        });
    }, [items, filters]);
    
    return (
        <div className="bg-white p-6 rounded-lg shadow-md">
            <h2 className="text-2xl font-bold mb-4">Çeyiz Listesi</h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <input type="text" placeholder="Ürün ara..." value={filters.search} onChange={e => setFilters({...filters, search: e.target.value})} className="p-2 border rounded-md w-full focus:outline-none focus:ring-2 focus:ring-pink-500" />
                <select value={filters.status} onChange={e => setFilters({...filters, status: e.target.value})} className="p-2 border rounded-md w-full bg-white focus:outline-none focus:ring-2 focus:ring-pink-500">
                    <option value="all">Tüm Durumlar</option>
                    <option value="alınacak">Alınacak</option>
                    <option value="alındı">Alındı</option>
                    <option value="hediye">Hediye Gelecek</option>
                </select>
                <select value={filters.priority} onChange={e => setFilters({...filters, priority: e.target.value})} className="p-2 border rounded-md w-full bg-white focus:outline-none focus:ring-2 focus:ring-pink-500">
                    <option value="all">Tüm Öncelikler</option>
                    <option value="zorunlu">Zorunlu</option>
                    <option value="isteğe bağlı">İsteğe Bağlı</option>
                    <option value="lüks">Lüks</option>
                </select>
            </div>
            <div className="space-y-4">
                {filteredItems.length > 0 ? filteredItems.map(item => (
                    <ItemCard key={item.id} item={item} category={categories.find(c => c.id === item.categoryId)} onUpdateStatus={onUpdateStatus} onDelete={onDelete} />
                )) : <p className="text-center text-gray-500 py-8">Listenizde hiç ürün yok veya filtrenize uygun sonuç bulunamadı.</p>}
            </div>
        </div>
    );
};

const Modal = ({ isOpen, onClose, title, children }) => {
    if (!isOpen) return null;

    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4" onClick={onClose}>
            <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-md" onClick={(e) => e.stopPropagation()}>
                <div className="flex justify-between items-center mb-4">
                    <h3 className="text-xl font-bold">{title}</h3>
                    <button onClick={onClose} className="text-gray-400 hover:text-gray-800">&times;</button>
                </div>
                <div>{children}</div>
            </div>
        </div>
    );
};

const Dashboard = ({ user, onLogout }) => {
    const [items, setItems] = useState(MOCK_DATA.items);
    const [totalBudget, setTotalBudget] = useState(user.totalBudget);
    const [weddingDate, setWeddingDate] = useState(user.weddingDate);
    const [showAddItemForm, setShowAddItemForm] = useState(false);
    const [notification, setNotification] = useState({ show: false, message: '' });
    const [isShareModalOpen, setShareModalOpen] = useState(false);
    const [isTemplateModalOpen, setTemplateModalOpen] = useState(false);

    const showNotification = (message) => {
        setNotification({ show: true, message });
        setTimeout(() => setNotification({ show: false, message: '' }), 3000);
    };

    const handleAddItem = (newItem) => {
        setItems(prev => [newItem, ...prev]);
        showNotification(`'${newItem.name}' listeye eklendi.`);
    };

    const handleUpdateStatus = (itemId, status) => {
        setItems(prev => prev.map(item => item.id === itemId ? { ...item, status } : item));
        showNotification(`Bir ürünün durumu güncellendi.`);
    };

    const handleDeleteItem = (itemId) => {
        const itemName = items.find(i => i.id === itemId)?.name || 'Ürün';
        setItems(prev => prev.filter(item => item.id !== itemId));
        showNotification(`'${itemName}' listeden silindi.`);
    };
    
    const handleAddTemplate = (template) => {
        const newItems = template.items.map(item => ({
            ...item,
            id: Date.now() + Math.random(),
            status: 'alınacak'
        }));
        setItems(prev => [...newItems, ...prev]);
        setTemplateModalOpen(false);
        showNotification(`'${template.name}' listeye eklendi.`);
    };

    const exportToCSV = () => {
        const headers = ["Ürün Adı", "Fiyat", "Durum", "Öncelik", "Kategori"];
        const categoriesMap = MOCK_DATA.categories.reduce((acc, cat) => ({...acc, [cat.id]: cat.name}), {});
        
        const rows = items.map(item => [
            item.name,
            item.price,
            item.status,
            item.priority,
            categoriesMap[item.categoryId]
        ].join(','));

        const csvContent = "data:text/csv;charset=utf-8," + [headers.join(','), ...rows].join("\n");
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "ceyiz_listesi.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    };

    const spentAmount = useMemo(() => {
        return items
            .filter(item => item.status === 'alındı')
            .reduce((sum, item) => sum + item.price, 0);
    }, [items]);

    const categorySpending = useMemo(() => {
        return items
            .filter(item => item.status === 'alındı')
            .reduce((acc, item) => {
                acc[item.categoryId] = (acc[item.categoryId] || 0) + item.price;
                return acc;
            }, {});
    }, [items]);

    return (
        <div className="bg-gray-50 min-h-screen">
            <Header user={user} onLogout={onLogout} weddingDate={weddingDate} />
            <main className="container mx-auto p-4 md:p-8">
                <BudgetSummary totalBudget={totalBudget} spentAmount={spentAmount} categorySpending={categorySpending} categories={MOCK_DATA.categories} />
                
                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <h2 className="text-3xl font-bold">Liste Yönetimi</h2>
                    <div className="flex gap-2 flex-wrap">
                        <button onClick={() => setShowAddItemForm(!showAddItemForm)} className="flex items-center gap-2 bg-pink-600 text-white px-4 py-2 rounded-full hover:bg-pink-700 transition-colors shadow-md">
                            <IconPlus /> {showAddItemForm ? 'Kapat' : 'Yeni Ürün'}
                        </button>
                        <button onClick={() => setTemplateModalOpen(true)} className="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-100">Şablon Ekle</button>
                        <button onClick={() => setShareModalOpen(true)} className="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-100"><IconUsers /></button>
                        <button onClick={exportToCSV} className="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-100"><IconDownload /></button>
                    </div>
                </div>

                {showAddItemForm && <AddItemForm categories={MOCK_DATA.categories} onAddItem={handleAddItem} onToggle={() => setShowAddItemForm(false)} />}
                
                <ItemList items={items} categories={MOCK_DATA.categories} onUpdateStatus={handleUpdateStatus} onDelete={handleDeleteItem} />
            </main>

            {/* Modals */}
            <Modal isOpen={isShareModalOpen} onClose={() => setShareModalOpen(false)} title="Listeyi Paylaş">
                <p className="text-gray-600 mb-4">Bu listeyi partnerinizle paylaşarak birlikte yönetebilirsiniz. Partnerinizin e-posta adresini girin:</p>
                <input type="email" defaultValue={user.partnerEmail} className="p-2 border rounded-md w-full mb-4 focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="Partner e-postası"/>
                <button className="w-full bg-pink-600 text-white py-2 rounded-lg hover:bg-pink-700">Davet Gönder</button>
            </Modal>
            
            <Modal isOpen={isTemplateModalOpen} onClose={() => setTemplateModalOpen(false)} title="Hazır Şablon Ekle">
                <div className="space-y-3">
                    {MOCK_DATA.templates.map(template => (
                        <div key={template.name} className="p-4 border rounded-lg flex justify-between items-center">
                            <div>
                                <h4 className="font-bold">{template.name}</h4>
                                <p className="text-sm text-gray-500">{template.items.length} ürün</p>
                            </div>
                            <button onClick={() => handleAddTemplate(template)} className="bg-pink-100 text-pink-700 px-3 py-1 rounded-full text-sm font-semibold hover:bg-pink-200">Ekle</button>
                        </div>
                    ))}
                </div>
            </Modal>

            {/* Notification */}
            <div className={`fixed bottom-5 right-5 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg transition-transform duration-300 ${notification.show ? 'translate-y-0 opacity-100' : 'translate-y-20 opacity-0'}`}>
                {notification.message}
            </div>
        </div>
    );
};

// --- ANA UYGULAMA BİLEŞENİ ---
export default function App() {
    const [user, setUser] = useState(null);

    const handleLogin = (userData) => {
        // Gerçek uygulamada burada bir token kaydedilir.
        setUser(userData);
    };

    const handleLogout = () => {
        setUser(null);
    };

    if (!user) {
        return <AuthPage onLogin={handleLogin} />;
    }

    return <Dashboard user={user} onLogout={handleLogout} />;
}
